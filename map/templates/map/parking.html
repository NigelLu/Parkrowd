{% extends "parkrowd/main.html" %}


{% block content %}
<style>
    #map {
        position: fixed !important; 
        bottom: 0; 
        height: 60vh; 
        width: 100%;
    }
</style>

<div id="map" style="height: 400px; width: 100%;"></div>
<button id="load-parking-btn">Load Parking Spots</button>

<script>
    let map;
    const loadParkingBtn = document.getElementById("load-parking-btn");

    function addMarker(spot) {
        let marker = new google.maps.Marker({
                position: {lat:parseFloat(spot.latitude), lng:parseFloat(spot.longitude)},
                map: map,
                title: spot.name
            });
            google.maps.event.addListener(marker, 'click', (function (marker) {
                return function () {
                    infowindow.setContent(spot.name);
                    infowindow.open(map, marker);
                }
            })(marker));
    }

    function fetchParkingSpotAroundCenter() {
        const center = map.getCenter();
        const lat = center.lat();
        const lng = center.lng();
        axios.get(`/api/spots/?lat=${lat}&lon=${lng}`)
            .then(function (response) {
                // Process the API response data here
                const spotsData = response.data;
                spotsData.forEach(spot => {
                    addMarker(spot);
                })
            })
            .catch(function (error) {
                // Handle any errors here
                console.log("Error retrieving data");
                console.log(error);
            });
    }

    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: 40.69446042799896, lng: -73.9864403526369},
            zoom: 18
        });
        let infowindow =  new google.maps.InfoWindow({});
        // let parkings = [
        //     {% for ps in parking_space %}
        //         {
        //             name: '{{ ps.business_name }}',
        //             latitude: parseFloat({{ps.latitude}}),
        //             longitude: parseFloat({{ps.longitude}}),
        //             // Add more fields as needed
        //         },
        //     {% endfor %}
        // ];
        // for (let i = 0; i < parkings.length; i++) {
        //     let marker = new google.maps.Marker({
        //         position: {lat:parkings[i].latitude, lng:parkings[i].longitude},
        //         map: map,
        //         title: parkings[i].name
        //     });
        //     google.maps.event.addListener(marker, 'click', (function (marker, i) {
        //         return function () {
        //             infowindow.setContent(parkings[i].name);
        //             infowindow.open(map, marker);
        //         }
        //     })(marker, i));
        // }
    }

    loadParkingBtn.addEventListener('click', function(e) {
        fetchParkingSpotAroundCenter();
    })
   
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_MAPS_API_KEY }}&callback=initMap"></script>
{% endblock %}